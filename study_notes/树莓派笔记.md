## 树莓派笔记

拿到树莓派四天了，我重装了三次系统，我想我有必要记录一下配置过程了。



### 材料

我使用的是树莓派3B，英国版，欧时电子生产，事实上欧时电子和易络盟生产的产品没有不同，英国版与中国版的区别也就是代工厂的所在地不同，甚至有很多人反映中国版的加工精细度要优于英国版，英国版的PCB的确有一些讨厌的毛边，除此之外完全没有区别。

除此之外，至少需要外壳，2.5A电源，最好是32G SD卡，class 10，读写速度越快越好，虽然网上有很多教程是关于完全无键盘鼠标，显示器的配置方法，但是我还是觉得有这些会方便很多很多。

所以，额外还需要键盘，鼠标，显示器，HDMI线。

散热片也是要贴的，这个很简单，就不描述了，注意别贴错就好。一般而言要贴三个芯片

当然还需要有线网，我的策略是首先使用有线网完成配置，之后切换到无线网。

我们首先需要准备系统，直接搜索树莓派即可，下载raspbian系统，img格式的，下载会得到一个压缩文件，解压即可，一般而言，解压得到的文件大概是4G多，下载的文件1.6G左右。

然后还需要，SD Card Formatter这个软件，自己搜索吧，第一次尝试烧录系统的时候我并未格式化，但是系统启动失败了，并不能确定一定是未格式化的问题，但是很有可能，建议还是先格式化。格式化的时候直接默认即可，默认应该就是快速格式化，只要注意一下盘符不要选错了。

然后需要Win32DiskImager这个软件来烧录系统，选择img文件所在位置，选择要烧录的盘符，然后write即可。

一切完成之后，插入SD卡即可。插入键盘鼠标，网线，电源，HDMI，然后开机。

### 系统配置

一般而言，我会首先选择做磁盘扩展和分辨率的更改。

打开Lx终端，输入`sudo raspi-config`，回车打开，使用方向键选择，首先选择第一项，扩展磁盘至整个空间，然后选择高级选项->分辨率，选择1920x1080 60Hz，使用左右方向键选择Finish，应该是需要重新启动的。

接下来，需要设置一下软件映像的源，在终端输入`sudo nano /etc/apt/sources.list`，回车，将在nano编辑器打开上述文件，使用方向键移动到源文件正文的末端，删除注释之外的所有内容，然后键入：

~~~
deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ jessie main non-free contrib
deb-src http://mirrors.ustc.edu.cn/raspbian/raspbian/ jessie main non-free contrib
~~~

然后`ctrl+x`退出，会让你选择时候保存为和原文件名字一致的文件，输入y，回车

上述操作将镜像替代为了中科大的开源镜像网站

然后在终端输入`sudo apt-get update`更新一下列表，中途如果有询问，输入y即可

下一步，安装vim，终端输入`sudo apt-get install vim`，如果报错了，一般而言原因是原本有一个`vim-common`，此时需要首先移除，输入命令`sudo apt-get remove vim-common`，同样如果询问，输入y

然后重新执行`sudo apt-get install vim`



下一步，需要开启SSH和VNC，直接在上面的bar上点击，选择首选项，然后选择树莓派配置，在选项卡里面找吧，很好找的，使能上述两项，然后还要选择最后一个选项卡，设置地区，时区，地区可以选择中国，时区选亚洲，香港，编码格式应该默认就是utf-8。保存，应该还是需要重启。



然后需要安装中文输入法和中文字体，在终端依次执行：

`sudo apt-get install ttf-wqy-microhei`和`sudo apt-get install fcitx fcitx-googlepinyin fcitx-module-cloudpinyin fcitx-sunpinyin`

网上也有安装很出名的龙泉驿开源中文字体的`sudo apt-get install ttf-wqy-zenhei`

输入法使用ctrl+space切换，如果没有中文的话，应该是你没选中文，打开fcitx的输入法设置，添加谷歌拼音即可

接下来，要配置wifi，我将使用修改文件手动添加wifi的方式，我认为这样非常便捷，并且可以添加已知的，但不在范围内的wifi，终端输入命令`sudo vim /etc/wpa_supplicant/wpa_supplicant.conf`，然后在文件的尾部加入：

~~~
network={
	ssid="xxxxxx"
	psk="xxxxxx"
	priority=4
}
~~~

其中优先级数字越大，级别越高

关于vim的操作的问题自己解决吧

只提一点，在linux里面，复制粘贴没有那么麻烦，ctrl的方式是不支持的，直接左键选中，那么复制已完成，中键就是粘贴



此时需要在桌面找到网络的图标，打开wifi，将网络切换到wifi模式



几乎是最后一步设置，我们需要解决校园网登陆问题。这里的问题解决策略是：

1.  完成一个python脚本，首先抓包搞清楚校园网登陆的表单格式，然后通过requests模块发送报单，会进行多次尝试，防止一次尝试失败。
2.  在同一个脚本内，获取ip地址，然后发送到邮箱
3.  将这个脚本设置为开机启动，注意为了防止系统尚未启动完成，脚本的一开始要延时一下，例如20秒

因为脚本涉及到了比较多的登录信息，这里不再给出，相信我已经保存了一份可靠的备份

只是说明一下如何将脚本设置为开机启动，按照网上的解决方案，他们认为有三种途径解决，分别是以服务的方式，设置权限的方式和修改`rc.local`的方式

我现在认为最后一个最快捷，也是最靠谱的。终端键入：`sudo vim /etc/rc.local`，打开这个文件，然后在`exit 0 `这一行之前输入你想要执行那个命令，例如`python3 /pi/home/blabla.py`，保存即可



此时最后检查一下VNC，SSH开启，wifi开启，为了方便，最好蓝牙也开启。哦，我们还需要更改一下密码，同样是`sudo raspi-config`，找到修改密码，输入即可，注意linux下，你输入密码是不会回显的，所以不必惊慌

至于root什么的，暂时可以不管。



最后最后，我还没有解决的问题是，键盘，我曾经正确的设置过，但是今天我不知为何无法重现，所以这个问题暂时搁置。



### 客户端

上述设置如果全部正确完成的话，接下来可以拔掉网线，键盘鼠标，HDMI，只保留电源线即可。

客户端主要使用两种，VNC viewer和PuTTY，前者类似于远程桌面，所以应该很清楚吧，远程桌面的话对网速有要求，会略显不流畅，同时往往分辨率也不会让人满意，至于下载就不说了，记住是viewer，别下载成服务器了。

后者这命令行界面，只传输命令行终端，下载，打开选择SSH，端口默认22即可，输入ip，之后还会需要用户名和密码，用户名是pi，默认的

基本上到这里就暂时告一段落了



### 警告

现阶段，我并不熟悉系统的操作，所以不要瞎搞

例如nginx和uwsgi，我暂时就用不上，所以别装了，上一次系统出问题就是因为安装这个，它似乎删了我几个软件，然后系统面目全非，亲爹都认不出来了，于是我重装了:cry:

