## Windows系统安装笔记

一般情况下，重装个系统还是很简单的，找到一个win系统的光盘映像，即ISO文件，然后找到一个刻录软件，把光盘映像刻录到U盘上。然后在电脑启动的时候进入BIOS，设置一下启动次序之类的，实现优先从U盘启动，成功进入安装界面之后就按提示正常操作就可以了。

但是，对于某些机型，例如戴尔的某些电脑，他们会比较特别，在启动的时候可能会发现会有所谓Legency和UEFI两种启动方式，在这些方式下从U盘启动，可能又会发现在选择要把系统安装到哪个磁盘上的时候会发现全都提示例如windows系统无法按照到GPT分区或者MBR分区的磁盘上诸如此类的。

也有可能会一切正常，但是在准备安装的时候，说无法找到驱动程序之类的。

所以，这到底是个什么鬼。

如果，再搜索一些资料，可能又会发现，有人说什么U盘的文件系统应该是FAT32而不是NTFS之类的。这又是什么？

总而言之，需要知道什么是Legency，UEFI, GPT, MBR, FAT32, NTFS。

其实这些去网上搜索一些资料，有不少写的都挺好的。但是如果完全不懂操作系统，文件系统之类的东西可能会比较理解。但是恰巧，前一段时间我尝试过做操作系统，所以某些东西还是稍微有一点实践经验的。



我之前在写操作系统的时候，使用的都是BIOS启动的方式，但是实际上BIOS是一个非常老的启动方式，需要使用汇编，系统的启动也必须要通过实模式，保护模式，最后才到64位模式。后来Intel提出了一种新的启动方式，叫做EFI，之后EFI被交给一个国际组织，同时也在EFI的基础上发展出了UEFI。

UEFI的绝大部分代码都使用C语言完成，也做了很多的改进，同时还能支持第三方的开发和界面的美化。

总而言之，UEFI是一种新的启动方式，也是未来。

现在的BIOS并没有退出，而是在其中加入了UEFI的拓展，也就是说可以在BIOS里面开启以UEFI的方式启动。

总之，使用传统方式启动的就是之前看到的Legency，另一种就是UEFI。这些都是非常靠近硬件的东西，是启动之初负责的东西。

接下来，就是分区表的问题(这一块，其实我也还没有特别懂)，具体表现就是对于一个磁盘，我们可以将它分为几个区，分区表负责这些工作。分区的形式有两种，分别是GPT和MBR，这里的MBR和我在FAT12里面看到的MBR应该还是不一样的，一个是广义的，一个是狭义的，前者并不是给操作系统看的。

这两者有什么区别呢？MBR属于比较老式的分区方式，局限性很大，分区的数量比较少，最多好像只能有4个主分区，另外对于硬盘整体，也只支持最大2T的。而GPT使用叫做GUID的分区表，最多支持128个分区，和128PB的磁盘。大概就是这些，总之GPT更加优秀。(上面的数字都是从网上某些地方直接抄来的，很可能不靠谱，重点在于直到GPT很厉害就行了)

所以说，看起来Legency与UEFI和GPT和MBR是没什么关系的，他们在描述不一样的东西，其实不然。传统的BIOS启动不支持GPT的分区形式，只支持MBR，而UEFI只支持GPT，这就是为什么会在安装的时候看到系统说无法在GPT或者MBR分区安装操作系统，就是因为你启动的时候的方式和磁盘的分区方式不匹配。

那么，假设我们真的就是选定了其中一种方式，然后到安装这一步分区形式不匹配，那么有没有办法对磁盘重新设置分区形式呢？在我们连操作系统都没装上的情况下，有的，如果已经进入了选择把系统安装到哪个磁盘的界面，此时windows的安装程序提供了一个命令行工具，可以对磁盘做操作。

此时，按`Shift+F10` 可以进入一个命令行界面，此时输入diskpart可以进入磁盘分区功能。

~~~powershell
list disk  # 列出磁盘信息
select disk 0  #选择其中我们的目标磁盘，注意搞清序号，别选错了，后果很严重的
clean    #清空当前磁盘，格式化，删除所有分区信息。 这里一定要警惕!!!!如果你知道你在做什么再执行，这种方式的代价是会抹去所有信息，注意是整个磁盘，而不是一个区。所以如果这块磁盘被分了C, D, E等几个区，这一步操作会把所有区全部都抹掉。所以一定要知道自己在干什么
convert gpt   #将整块磁盘转化为GPT分区，convert mbr是MBR分区。
create partition primary size=102400   # 创建一个主分区，大小是102400MB，即100GB
formart fs=ntfs qucik # 将这个分区格式化为ntfs文件系统
exit   #退出diskpart
exit   #退出命令行
~~~

以上操作一定要谨慎，确认你真的看懂了你在做什么。



从上面的内容应该可以看出，推荐的方式应该是UEFI+GPT，这需要磁盘本身是GPT，同时启动时是从UEFI的方式进入的。有些甚至必须使用UEFI+GPT，例如昨天遇到的Dell电脑。



欧科，基本上以上已经说了全部的关于机器本身的要点，那么烧录着系统的U盘本身有要求吗？就直接使用默认刻录设置进行刻录吗？

我之前使用的刻录软件是推荐很多的软碟通，即`UltraISO`, 但是实际上我刻录出来的系统盘在上述Dell电脑上并不能用，无法在UEFI中识别出来U盘，只能在Legency中识别出来。这意味着，系统盘其实也有特定的分区格式。

进而，我去搜索，有人提到，说如果想刻录UEFI的系统盘，需要让U盘的文件系统是FAT32，检查之后，我发现我刻出来的是NTFS文件系统，于是我重新格式化，按照网上给出的让软碟通保持原始文件系统的方法进行刻录，但是刻录到最后报出了错误，然后他竟然又继续了，完成之后。再重新启动，这一次成功在UEFI中识别出了U盘，但是在安装程序启动之后，又报了无法找到驱动程序的错误。

网上搜索一番，有人给了不少方法，例如重新插入U盘，换一个USB接口，使用命令行启动setup.exe等方法，但是我测试之后发现统统不行。

我认为这是在刻录中那个错误导致的，网上搜索了一番，在youtube上，我发现了有一个人给出了一种很出乎我意料的方法：直接在电脑中打开ISO，然后将U盘格式化为FAT32，然后直接将文件全部拷过去就行了。

据我的理解，刻录的特别之处在于主引导记录的一些特别。所以我其实有点怀疑他这种方法到底行不行。

但是，如果你直接尝试这种方式，就会发现也会报错。报错内容基本就是单个文件超出了4GB。其实稍微了解一下FAT32系统，就会知道这个系统采用32bit对簇进行进行编号，这样一定会对单个文件的大小作出限制。这个限制实际就是4GB。

总而言之，我们不能使用FAT32文件系统刻录大于4GB的ISO，只能选择NTFS。

也就是说，前面有人说UEFI只能用FAT32是错的。

我再搜索了一番，找到了[这篇博客](https://blog.csdn.net/ZuoWeiXiaoDuZuoZuo/article/details/85233259)，其中提到了一个靠谱的刻录软件，叫做Rufus，这个软件明显要比软碟通靠谱太多了，操作简单，也不会造成我的系统一卡一卡的。

在这个软件里面应该可以看到，有分区类型和目标系统类型的选项，于是我们就可以选择GPT和UEFI的搭配，当侦测到镜像很大，它会自动帮我们选择NTFS文件系统，然后刻录就可以了。

这样我们就得到了一个支持UEFI方式的系统安装盘，按照合适的步骤操作，从U盘启动，然后正常安装，应该没有什么问题了。



另外需要稍微提醒一些，有些时候呢，安装完成，系统重启之后，有些电脑会在系统准备就绪的界面停留很久，不用太过担心，等着就好。



基本上，昨天搞定的就是这些。



如何查看电脑里现在的磁盘是什么分区格式呢？在磁盘管理中，直接选中磁盘，例如磁盘0，右键属性，在卷选项卡中就可以看到磁盘分区格式。