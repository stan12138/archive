## Pyinstaller笔记



### 要求与安装

在windows上面依赖两个包，pywin32和pefile，前者也可以使用pypiwin32，当使用pip安装的时候pywin32可能会自动安装

直接使用pip安装pyinstaller即可



### 工作与使用

文档其实并不长，虽然是英文但是正文只有50多页，再去掉一些纯粹面向多平台的说明，会更少，今天应该可以读完。



对于绝大多数的应用，可以直接使用`pyinstaller myscript.py`完成打包，当然也是可以添加额外的命令的，例如`pyinstaller -onefile -windowed myscript.py`这样将产生一个单文件带窗口的打包

打包结果依赖于平台，本平台打包的结果只能在本类平台运行



pyinstaller会自动分析你的导入，然后自动包含这些文件，但是某些特殊的导入是无法分析的，例如使用了`__import()__,imp.find_module()`或者使用了系统的环境变量，这种情况下，应该提供额外的辅助：

-   可以在命令中给出额外的文件
-   可以在命令中加入额外的导入路径
-   可以编辑`myscript.spec`文件，这个文件但你初次打包的时候会有pyinstaller自动生成
-   可以特别的写一个钩子，这是一种通用的针对特殊导入的工具

如果代码中包含了特殊的数据文件，那么也应该通过spec文件告诉pyinstaller



普通情形下，pyinstaller是one folder模式，生成一个文件夹，缺陷在于会包含很多文件，但是也容易debug和修改

one file模式下，将会只生成一个可运行文件而已，缺陷在于单个文件同样会很大，并且运行速度低于单文件夹模式

要注意的是，单文件模式可以同时运行多次相同文件，但是毫无疑问，运行越多占空间也多，运行时会临时生成一个`_MEIxxxxxx`文件夹，后六位是随机数，正常情况下，程序退出时会自动删除，但是如果程序非正常结束，例如crash或者被强制kill，那么这个文件夹可能会留下来。



我们可以提供命令窗口，此时可以使用标准输入输出进行交互，错误信息也会被输出至此



提供特殊的源代码隐藏功能



完整的命令形式是：

`pyinstaller [options] script [script....] | specfile`



单文件夹模式下，会产生spec文件，build文件夹下将包含一些log文件，dist文件夹下将包含得到的可运行文件

如果你因为特殊原因修改了spec文件，然后应该`pyinstaller myscript.spec`来取代原文件



至于命令中的options暂时不提

当使用了很多options的时候，命令会变得很长，这是为了可读性可能会需要使用续行功能，自然这个依赖平台



可以使用python命令代替pyinstaller命令来提供额外的优化选项，举一个栗子`python -OO -m PyInstaller myscript.py`

当然还有其他更加复杂，或者略简化的形式，感觉这个我用不上，就不说了



使用UPX，UPX是一个可以在绝大多书os上面使用的压缩工具，它可以大大缩小文件和库，支持绝大多数可执行文件格式，这个可以往后放一下



